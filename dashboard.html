<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AlphaJournal Dashboard</title>
<style>
  body {
    background-color: #0e0f11;
    color: #e2e2e2;
    font-family: "Inter", sans-serif;
    margin: 0;
    padding: 0;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 40px;
    background: #15171a;
    border-bottom: 1px solid #222;
  }
  h1 { color: #00e0ff; font-weight: 600; }
  button {
    background: #00e0ff;
    color: #000;
    border: none;
    border-radius: 6px;
    padding: 10px 16px;
    cursor: pointer;
    font-weight: 600;
  }
  main {
    display: flex;
    justify-content: space-between;
    padding: 30px;
    gap: 30px;
  }
  .dashboard {
    flex: 2;
    background: #15171a;
    padding: 20px;
    border-radius: 12px;
  }
  .calendar {
    flex: 1;
    background: #15171a;
    padding: 20px;
    border-radius: 12px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #222;
  }
  .win { color: #00ff99; }
  .loss { color: #ff4d4d; }
  .be { color: #b5b5b5; }
  .action-btn { cursor: pointer; margin: 0 5px; }
  canvas {
    width: 100%;
    height: 200px;
    margin-top: 15px;
  }
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
    margin-top: 15px;
  }
  .day {
    padding: 10px;
    border-radius: 6px;
    text-align: center;
    background: #222;
  }
  .day.win { background: #007f5f; color: #fff; }
  .day.loss { background: #8b0000; color: #fff; }
  .day.be { background: #555; color: #fff; }
</style>
</head>
<body>
<header>
  <h1>AlphaJournal</h1>
  <div>
    <button id="addTradeBtn">+ Adicionar Trade</button>
    <button onclick="clearTrades()">üßπ Limpar Tudo</button>
  </div>
</header>

<main>
  <section class="dashboard">
    <h2>Resumo</h2>
    <p><b>Lucro Total:</b> <span id="totalProfit">US$ 0.00</span> | 
       <b>Winrate:</b> <span id="winrate">0%</span> | 
       <b>Trades:</b> <span id="tradeCount">0</span></p>

    <table>
      <thead>
        <tr>
          <th>Par</th>
          <th>Resultado</th>
          <th>Data</th>
          <th>RR</th>
          <th>Coment√°rio</th>
          <th>Dire√ß√£o</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="tradeTableBody"></tbody>
    </table>

    <canvas id="equityChart"></canvas>
  </section>

  <section class="calendar">
    <h2>Calend√°rio</h2>
    <div id="calendarGrid" class="calendar-grid"></div>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let trades = JSON.parse(localStorage.getItem("trades")) || [];
const ctx = document.getElementById('equityChart').getContext('2d');
let chart;

// === Atualiza gr√°fico e tabela ===
function renderAll() {
  const tbody = document.getElementById("tradeTableBody");
  tbody.innerHTML = "";

  let total = 0;
  let wins = 0;

  trades.forEach((t, i) => {
    const tr = document.createElement("tr");
    const cls = t.result > 0 ? "win" : t.result < 0 ? "loss" : "be";
    tr.innerHTML = `
      <td>${t.pair}</td>
      <td class="${cls}">${t.result > 0 ? 'WIN' : t.result < 0 ? 'LOSS' : 'BE'} 
      (${t.result >= 0 ? '+' : ''}US$ ${t.result.toFixed(2)})</td>
      <td>${new Date(t.date).toLocaleDateString("pt-BR")}</td>
      <td>${t.rr}</td>
      <td>${t.comment}</td>
      <td>${t.dir}</td>
      <td>
        <span class="action-btn" onclick="editTrade(${i})">‚úèÔ∏è</span>
        <span class="action-btn" onclick="deleteTrade(${i})">üóëÔ∏è</span>
      </td>`;
    tbody.appendChild(tr);

    total += t.result;
    if (t.result > 0) wins++;
  });

  document.getElementById("totalProfit").textContent = `US$ ${total.toFixed(2)}`;
  document.getElementById("winrate").textContent = 
    trades.length ? `${Math.round((wins / trades.length) * 100)}%` : "0%";
  document.getElementById("tradeCount").textContent = trades.length;

  localStorage.setItem("trades", JSON.stringify(trades));
  renderChart();
  renderCalendar();
}

// === Gr√°fico ===
function renderChart() {
  const labels = trades.map(t => t.date);
  const equity = [];
  let running = 0;
  trades.forEach(t => { running += t.result; equity.push(running); });

  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Equity',
        data: equity,
        borderColor: '#00e0ff',
        borderWidth: 2,
        fill: false,
        tension: 0.2
      }]
    },
    options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: false } } }
  });
}

// === Calend√°rio ===
function renderCalendar() {
  const grid = document.getElementById("calendarGrid");
  grid.innerHTML = "";
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  for (let d = 1; d <= daysInMonth; d++) {
    const div = document.createElement("div");
    div.className = "day";
    div.textContent = d;

    const dayTrades = trades.filter(t => {
      const dt = new Date(t.date);
      return dt.getFullYear() === year && dt.getMonth() === month && dt.getDate() === d;
    });

    if (dayTrades.length) {
      const profit = dayTrades.reduce((a, b) => a + b.result, 0);
      if (profit > 0) div.classList.add("win");
      else if (profit < 0) div.classList.add("loss");
      else div.classList.add("be");
    }

    grid.appendChild(div);
  }
}

// === Adicionar nova trade ===
document.getElementById("addTradeBtn").onclick = () => {
  const pair = prompt("Par (ex: XAUUSD):");
  const result = parseFloat(prompt("Resultado em US$ (ex: -10 ou 30):"));
  const rr = prompt("RR (ex: 1:2.5):");
  const comment = prompt("Coment√°rio:");
  const dir = prompt("Dire√ß√£o (BUY/SELL):");
  const date = prompt("Data (AAAA-MM-DD):", new Date().toISOString().split("T")[0]);
  const img1 = prompt("URL da 1¬™ imagem (opcional):");
  const img2 = prompt("URL da 2¬™ imagem (opcional):");

  const imgs = [];
  if (img1) imgs.push(img1);
  if (img2) imgs.push(img2);

  if (pair && !isNaN(result)) {
    trades.push({ pair, result, rr, comment, dir, date, imgs });
    renderAll();
  }
};

// === Editar trade ===
function editTrade(i) {
  const t = trades[i];
  const pair = prompt("Par:", t.pair);
  const result = parseFloat(prompt("Resultado US$:", t.result));
  const rr = prompt("RR:", t.rr);
  const comment = prompt("Coment√°rio:", t.comment);
  const dir = prompt("Dire√ß√£o:", t.dir);
  const date = prompt("Data (AAAA-MM-DD):", t.date);
  const img1 = prompt("URL da 1¬™ imagem:", (t.imgs && t.imgs[0]) || "");
  const img2 = prompt("URL da 2¬™ imagem:", (t.imgs && t.imgs[1]) || "");

  const imgs = [];
  if (img1) imgs.push(img1);
  if (img2) imgs.push(img2);

  trades[i] = { pair, result, rr, comment, dir, date, imgs };
  renderAll();
}

// === Deletar trade ===
function deleteTrade(i) {
  if (confirm("Deseja apagar esta trade?")) {
    trades.splice(i, 1);
    renderAll();
  }
}

// === Limpar tudo ===
function clearTrades() {
  if (confirm("Apagar todas as trades?")) {
    trades = [];
    localStorage.removeItem("trades");
    renderAll();
  }
}

renderAll();
</script>
</body>
</html>
