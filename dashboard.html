<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - AlphaJournal</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<header class="navbar">
    <h2>AlphaJournal</h2>
    <button id="logoutBtn" class="btn-logout">Sair</button>
</header>

<main class="container">
    <h3 id="usernameDisplay">OlÃ¡, Trader ðŸ‘‹</h3>

    <div class="stats-grid">
        <div class="card">
            <h4>Trades</h4>
            <p id="totalTrades">0</p>
        </div>
        <div class="card">
            <h4>Lucro Total (R$)</h4>
            <p id="totalProfit">0.00</p>
        </div>
        <div class="card">
            <h4>Winrate (%)</h4>
            <p id="winrate">0%</p>
        </div>
    </div>

    <h3 style="margin-top: 20px;">HistÃ³rico de Trades</h3>

    <table class="trade-table">
        <thead>
            <tr>
                <th>Ativo</th>
                <th>Data</th>
                <th>Resultado</th>
            </tr>
        </thead>
        <tbody id="tradeList">
            <tr><td colspan="3" style="text-align:center">Carregando...</td></tr>
        </tbody>
    </table>

    <button id="addTradeBtn" class="btn-float">+</button>
</main>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBGeQ1-IKrCyC8hA2BETaJLidLpuYrCRmk",
  authDomain: "alphajournal-dc6bb.firebaseapp.com",
  projectId: "alphajournal-dc6bb",
  storageBucket: "alphajournal-dc6bb.firebasestorage.app",
  messagingSenderId: "835722822229",
  appId: "1:835722822229:web:974ee6dc7b6696f1edcadc"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const logoutBtn = document.getElementById("logoutBtn");
const addTradeBtn = document.getElementById("addTradeBtn");
const tradeList = document.getElementById("tradeList");

logoutBtn.addEventListener("click", () => {
    signOut(auth);
});

addTradeBtn.addEventListener("click", () => {
    window.location.href = "register-trade.html";
});

onAuthStateChanged(auth, (user) => {
    if (!user) return window.location.href = "index.html";

    document.getElementById("usernameDisplay").innerText = 
        `OlÃ¡, ${user.email.split("@")[0]} ðŸ‘‹`;

    const q = query(collection(db, "trades"), where("uid", "==", user.uid));
    onSnapshot(q, (snapshot) => {
        tradeList.innerHTML = "";
        let totalProfit = 0;
        let wins = 0;

        snapshot.forEach((doc) => {
            const trade = doc.data();
            totalProfit += Number(trade.resultado);

            if (trade.resultado > 0) wins++;

            tradeList.innerHTML += `
                <tr>
                    <td>${trade.ativo}</td>
                    <td>${trade.data}</td>
                    <td style="color:${trade.resultado >= 0 ? "#00eaff" : "red"}">
                        R$ ${trade.resultado.toFixed(2)}
                    </td>
                </tr>
            `;
        });

        document.getElementById("totalTrades").innerText = snapshot.size;
        document.getElementById("totalProfit").innerText = totalProfit.toFixed(2);
        const winrate = snapshot.size > 0 ? (wins / snapshot.size * 100).toFixed(1) : 0;
        document.getElementById("winrate").innerText = winrate + "%";
    });
});
</script>

</body>
</html>
