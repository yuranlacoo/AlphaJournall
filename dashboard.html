<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AlphaJournal</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#0d0f11;color:#eee}
header{display:flex;justify-content:space-between;align-items:center;padding:15px 25px;background:#101214;border-bottom:1px solid #222}
h1{color:#00e0ff;font-size:20px;margin:0}
button{cursor:pointer;border:none;border-radius:6px;padding:8px 12px;font-weight:bold}
button.primary{background:#00e0ff;color:#000}
button.secondary{background:#1b1d20;color:#ccc}
main{display:flex;gap:20px;padding:20px}
.left{flex:2;background:#151719;padding:15px;border-radius:10px}
.right{width:350px;background:#151719;padding:15px;border-radius:10px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid #222;text-align:left}
.win{color:#00ff8f} .loss{color:#ff5e5e} .be{color:#888}
.thumb{width:40px;height:32px;object-fit:cover;border-radius:5px;margin-right:5px;cursor:pointer}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;z-index:10}
.modal-content{background:#111;padding:20px;border-radius:8px;max-width:500px;width:90%}
.modal-content input,textarea,select{width:100%;margin:6px 0;padding:8px;border-radius:6px;border:1px solid #333;background:#0d0f11;color:#eee}
.close{background:#00e0ff;color:#000;margin-top:10px}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:10px}
.day{height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#222;color:#bbb}
.day.win{background:#007f5f;color:#fff}
.day.loss{background:#b22222;color:#fff}
.day.be{background:#666;color:#fff}
.chart{margin-top:15px}
</style>
</head>
<body>

<header>
  <h1>AlphaJournal</h1>
  <div>
    <button class="primary" id="addBtn">+ Adicionar Trade</button>
    <button class="secondary" id="clearBtn">Limpar Tudo</button>
  </div>
</header>

<main>
  <div class="left">
    <h3>Resumo</h3>
    <p id="summary">Lucro: US$ 0.00 | Winrate: 0% | Trades: 0</p>
    <table>
      <thead><tr><th>Par</th><th>Resultado</th><th>Data</th><th>Coment√°rio</th><th>Imagens</th><th>A√ß√µes</th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
    <div class="chart"><canvas id="equityChart"></canvas></div>
  </div>

  <div class="right">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <button class="secondary" id="prevMonth">‚Üê</button>
      <h4 id="monthLabel">M√™s</h4>
      <button class="secondary" id="nextMonth">‚Üí</button>
    </div>
    <small style="color:#888">verde=win ‚Ä¢ vermelho=loss ‚Ä¢ cinza=be</small>
    <div class="calendar" id="calendar"></div>
  </div>
</main>

<!-- MODAL -->
<div class="modal" id="tradeModal">
  <div class="modal-content">
    <h3 id="modalTitle">Nova Trade</h3>
    <input id="pair" placeholder="Par (ex: XAUUSD)">
    <input id="result" placeholder="Resultado (ex: 30 ou -20)">
    <input id="date" type="date">
    <textarea id="comment" placeholder="Coment√°rio"></textarea>
    <input id="img1" type="file" accept="image/*">
    <input id="img2" type="file" accept="image/*">
    <button class="close" id="saveBtn">Salvar</button>
  </div>
</div>

<script>
let trades = JSON.parse(localStorage.getItem("trades")||"[]");
let editIndex=-1,month=new Date().getMonth(),year=new Date().getFullYear();
let chart;

function save(){localStorage.setItem("trades",JSON.stringify(trades));}
function fmt(v){return "US$ "+Number(v).toFixed(2);}
function render(){
  const tbody=document.getElementById("tbody");
  tbody.innerHTML="";
  let total=0,wins=0;
  trades.forEach((t,i)=>{
    total+=t.result;if(t.result>0)wins++;
    const tr=document.createElement("tr");
    const cls=t.result>0?"win":t.result<0?"loss":"be";
    const imgs=t.imgs?.map(s=>`<img src="${s}" class="thumb">`).join("")||"‚Äî";
    tr.innerHTML=`<td>${t.pair}</td><td class="${cls}">${t.result>0?'+':''}${fmt(t.result)}</td><td>${t.date}</td><td>${t.comment||''}</td><td>${imgs}</td>
    <td><button onclick="edit(${i})">‚úèÔ∏è</button><button onclick="del(${i})">üóëÔ∏è</button></td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("summary").innerText=`Lucro: ${fmt(total)} | Winrate: ${trades.length?Math.round((wins/trades.length)*100):0}% | Trades: ${trades.length}`;
  save();renderCalendar();renderChart();
}
function renderCalendar(){
  const c=document.getElementById("calendar");c.innerHTML="";
  const label=new Date(year,month,1).toLocaleString("pt-BR",{month:"long",year:"numeric"});
  document.getElementById("monthLabel").innerText=label.charAt(0).toUpperCase()+label.slice(1);
  const days=new Date(year,month+1,0).getDate();
  for(let d=1;d<=days;d++){
    const div=document.createElement("div");div.className="day";div.innerText=d;
    const date=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const ts=trades.filter(t=>t.date===date);
    if(ts.length){const sum=ts.reduce((a,b)=>a+b.result,0);div.classList.add(sum>0?"win":sum<0?"loss":"be");}
    c.appendChild(div);
  }
}
function renderChart(){
  const ctx=document.getElementById("equityChart");
  let eq=0,labels=[],data=[];
  trades.sort((a,b)=>new Date(a.date)-new Date(b.date)).forEach(t=>{eq+=t.result;labels.push(t.date);data.push(eq);});
  if(chart)chart.destroy();
  chart=new Chart(ctx,{type:'line',data:{labels,datasets:[{label:'Equity',data,borderColor:'#00e0ff',fill:true,tension:.3}]},options:{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#888'}},y:{ticks:{color:'#888'}}}}});
}
function openModal(i=-1){editIndex=i;document.getElementById("tradeModal").style.display="flex";
  const t=i==-1?{}:trades[i];document.getElementById("pair").value=t.pair||'';document.getElementById("result").value=t.result||'';document.getElementById("date").value=t.date||'';document.getElementById("comment").value=t.comment||'';
}
function closeModal(){document.getElementById("tradeModal").style.display="none";}
async function saveTrade(){
  const pair=document.getElementById("pair").value.trim(),result=Number(document.getElementById("result").value||0),date=document.getElementById("date").value,comment=document.getElementById("comment").value.trim();
  const f1=document.getElementById("img1").files[0],f2=document.getElementById("img2").files[0];
  const imgs=[];
  if(f1)imgs.push(await toB64(f1));
  if(f2)imgs.push(await toB64(f2));
  const obj={pair,result,date,comment,imgs};
  if(editIndex==-1)trades.push(obj);else trades[editIndex]=obj;
  closeModal();render();
}
function del(i){if(confirm("Remover trade?")){trades.splice(i,1);render();}}
function edit(i){openModal(i);}
function toB64(f){return new Promise(r=>{const rd=new FileReader();rd.onload=()=>r(rd.result);rd.readAsDataURL(f);});}
document.getElementById("addBtn").onclick=()=>openModal(-1);
document.getElementById("saveBtn").onclick=saveTrade;
document.getElementById("tradeModal").onclick=e=>{if(e.target.id==="tradeModal")closeModal();}
document.getElementById("clearBtn").onclick=()=>{if(confirm("Apagar todas as trades?")){trades=[];save();render();}};
document.getElementById("prevMonth").onclick=()=>{month--;if(month<0){month=11;year--;}renderCalendar();};
document.getElementById("nextMonth").onclick=()=>{month++;if(month>11){month=0;year++;}renderCalendar();};
render();
</script>
</body>
</html>
